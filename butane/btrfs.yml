variant: fcos
version: 1.6.0

storage:
  directories:
    - path: /var/srv/fast

systemd:
  units:
    - name: selinux-restorecon@.service
      enabled: false
      contents: |
        [Unit]
        Description=Restore SELinux contexts on /%I (derived) after mount
        After=%i.mount
        Requires=%i.mount

        [Service]
        Type=oneshot
        # instance like "var-music" -> "/var/music"
        ExecStart=/usr/bin/sh -c 'p="/%I"; p="${p//-//}"; exec /usr/sbin/restorecon -RFv "$p"'

    - name: mnt@.mount
      enabled: false
      contents: |
        [Unit]
        Description=Mount %i
        ConditionPathExists=/dev/disk/by-label/%i

        [Mount]
        What=/dev/disk/by-label/%i
        Where=/var/srv/%i
        Type=btrfs
        Options=nofail,subvol=/

    - name: mnt@.automount
      enabled: false
      contents: |
        [Unit]
        Description=Automount %i

        [Automount]
        Where=/var/srv/%i
        TimeoutIdleSec=2min

        [Install]
        WantedBy=multi-user.target

    - name: fast@.mount
      enabled: false
      contents: |
        [Unit]
        Description=Mount %i from fast:@%i
        ConditionPathExists=/dev/disk/by-label/fast

        [Mount]
        What=/dev/disk/by-label/fast
        Where=/var/%i
        Type=btrfs
        Options=nofail,subvol=@%i

    - name: fast@.automount
      enabled: false
      contents: |
        [Unit]
        Description=Automount %i

        [Automount]
        Where=/var/%i
        TimeoutIdleSec=2min

        [Install]
        WantedBy=multi-user.target

    - name: fast@music.automount
      enabled: true
    - name: selinux-restorecon@var-music.service
      enabled: true

    - name: fast@apps.automount
      enabled: true
    - name: selinux-restorecon@var-apps.service
      enabled: true

    - name: fast@git.automount
      enabled: true
    - name: selinux-restorecon@var-git.service
      enabled: true

    - name: fast@docs.automount
      enabled: true
    - name: selinux-restorecon@var-docs.service
      enabled: true

    - name: fast@videos.automount
      enabled: true
    - name: selinux-restorecon@var-videos.service
      enabled: true

    - name: fast@photos.automount
      enabled: true
    - name: selinux-restorecon@var-photos.service
      enabled: true

    - name: fast@snapshots.automount
      enabled: true
    - name: selinux-restorecon@var-snapshots.service
      enabled: true

    - name: var-music-touhou.mount
      enabled: false
      contents: |
        [Unit]
        Description=Mount touhou music
        ConditionPathExists=/dev/disk/by-label/fast
        [Mount]
        What=/dev/disk/by-label/fast
        Where=/var/music/touhou
        Type=btrfs
        Options=nofail,subvol=@touhou

    - name: var-music-touhou.automount
      enabled: true
      contents: |
        [Unit]
        Description=Automount touhou music
        [Automount]
        Where=/var/music/touhou
        TimeoutIdleSec=2min
        [Install]
        WantedBy=multi-user.target

    - name: selinux-restorecon@var-music-touhou.service
      enabled: true

    - name: game@.mount
      enabled: false
      contents: |
        [Unit]
        Description=Mount %i from fast:@%i
        ConditionPathExists=/dev/disk/by-label/fast

        [Mount]
        What=/dev/disk/by-label/fast
        Where=/var/games/%i
        Type=btrfs
        Options=nofail,subvol=@%i

    - name: game@.automount
      enabled: false
      contents: |
        [Unit]
        Description=Automount %i

        [Automount]
        Where=/var/games/%i
        TimeoutIdleSec=2min

        [Install]
        WantedBy=multi-user.target
    
    - name: game@minecraft.automount
      enabled: true
    - name: selinux-restorecon@var-games-minecraft.service
      enabled: true

    - name: game@steam.automount
      enabled: true
    - name: selinux-restorecon@var-games-steam.service
      enabled: true